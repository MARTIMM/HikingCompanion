[TOC]

# Designing the application
## Diagrams showing the relations of the classes

Examples of certain classes are shown here: 1) Class inheriting from QObject 2) based on templates are drawn like
```plantuml
class someClass1 << (O,yellow) >>
class someClass2 << (T,lightblue) >>
```

### Basic structure
The `ConfigData` is a singleton class which is used to keep all data alive and therefore it is not necessary to initialize all data again and again upon instantiation of an object. The `Config` class will become a hook to get to the data from QML.

```plantuml
class "Singleton<ConfigData>" as ConfigData << (S,#FF7700) >>
class Config << (O,yellow) >>
'class GpxManager << (O,yellow) >>
class GpxFiles << (O,yellow) >>
class GpxFile << (O,yellow) >>

class call_once << (T,lightblue) >>
class Singleton << (T,lightblue) >>


Config *- ConfigData
'ConfigData *- GpxManager
ConfigData *- GpxFiles
'GpxManager *- GpxFiles
GpxFiles *- GpxFile

call_once -- Singleton
Singleton -- ConfigData
```

# Code snippets
Working with qtcreator based on qt 5.11.1, build on July 17th 2018

## Using QVariantList to populate a QML ComboBox

Snippets to show how to populate a `QML` `ComboBox` from data held in c++.
In the end the result looks like: <img src="Images/Screenshot_20180829_121215.png" />

### C++ gpxfiles.h
```
#ifndef GPXFILES_H
#define GPXFILES_H

#include <QObject>
#include <QVariantList>

class GpxFiles : public QObject {

  Q_OBJECT
  Q_PROPERTY( bool readGpxFileInfo READ readGpxFileInfo)

public:
  explicit GpxFiles(QObject *parent = nullptr);
  ~GpxFiles();

  Q_INVOKABLE QVariantList gpxTrackList();

signals:
  void gpxFileListChanged();

public slots:

private:
  void _setGpxFiles();

  QVariantList _gpxTrackList;
};

#endif // GPXFILES_H
```

### C++ gpxfiles.cpp
```
#include "gpxfiles.h"

GpxFiles::GpxFiles( QObject *parent) : QObject(parent) {}

GpxFiles::~GpxFiles() {
  _gpxTrackList.clear();
}

QVariantList GpxFiles::gpxTrackList() {
  return _gpxTrackList;
}

bool GpxFiles::readGpxFileInfo() {
  _setGpxFiles();
  emit gpxFileListChanged();
  return true;
}

void GpxFiles::_setGpxFiles() {

  _gpxTrackList.clear();
  _gpxTrackList.append("Sufi1_01_Istanbul City");
  _gpxTrackList.append("Sufi1_02_Yalova_Gökçedere");
  _gpxTrackList.append("Sufi1_03_Gökçedere_Güneyköy");
  ...
}
```
### The main.cpp file
```
#include "gpxfiles.h"

#include <QGuiApplication>
#include <QQmlApplicationEngine>

// ----------------------------------------------------------------------------
int main( int argc, char *argv[]) {

  QGuiApplication app( argc, argv);

  qmlRegisterType<GpxFiles>(
        "io.github.martimm.HikingCompanion.GpxFiles", 0, 1, "GpxFiles"
        );

  QQmlApplicationEngine engine;
  engine.load(QUrl(QStringLiteral("qrc:/test.qml")));

  if ( engine.rootObjects().isEmpty() ) return -1;
  return app.exec();
}
```

### QML file test.qml
```
import io.github.martimm.HikingCompanion.GpxFiles 0.1

import QtQuick 2.9
import QtQuick.Controls 2.2
import QtQuick.Window 2.3

ApplicationWindow {
  id: root
  visible: true
  width: 500
  height: 200

  Component.onCompleted: {
    // read the data after which the object will emit signal gpxFileListChanged
    gpxf.readGpxFileInfo;
  }

  GpxFiles {
    id: gpxf

    onGpxFileListChanged: {
      cb.model = gpxf.gpxTrackList();
    }
  }

  ComboBox {
    id: cb
    width: parent.width
  }
}
```

## Using QVariantList or QStringList to populate a QML ListView

The following QML file can be used to use a `ListView`. Key here is the use of `delegate` and the `modelData` field which is probably generated by QT. The result now looks like: <img src="Images/Screenshot_20180829_120926.png" />.
`QVariantList` can also be replaced by `QStringList`.

```
import io.github.martimm.HikingCompanion.GpxFiles 0.1

import QtQuick 2.9
import QtQuick.Controls 2.2
import QtQuick.Window 2.3


ApplicationWindow {
  id: root
  visible: true
  width: 500
  height: 200

  Component.onCompleted: {
    gpxf.readGpxFileInfo;
  }

  GpxFiles {
    id: gpxf

    onGpxFileListChanged: {
      lv.model = gpxf.gpxTrackList();
    }
  }

  ListView {
    id: lv
    width: parent.width
    height: parent.height
    delegate: Rectangle {
      width: parent.width
      height: 20
      Text { text: modelData }
    }
  }
}
```
